# AGENTS.md

## Proposito del repositorio
{{project_description}}

## Stack tecnologico
{{#stacks}}
- {{.}}
{{/stacks}}

## Comandos canonicos
- Instalar dependencias: `{{commands.install}}`
{{#has_dev}}
- Ejecutar en local: `{{commands.dev}}`
{{/has_dev}}
{{#has_build}}
- Compilar: `{{commands.build}}`
{{/has_build}}
{{#has_lint}}
- Lint: `{{commands.lint}}`
{{/has_lint}}
{{#has_format}}
- Formato: `{{commands.format}}`
{{/has_format}}
{{#has_tests}}
- Pruebas: `{{commands.test}}`
{{/has_tests}}

## Definicion de terminado
Antes de considerar una tarea completa:
{{#has_tests}}
- [ ] `{{commands.test}}` pasa sin errores
{{/has_tests}}
{{#has_lint}}
- [ ] `{{commands.lint}}` pasa sin errores
{{/has_lint}}
- [ ] No anadir dependencias nuevas sin confirmacion
- [ ] Documentar cambios en APIs publicas

## Estilo y convenciones
{{style_notes}}

{{#has_tests}}
## Guia de pruebas
{{testing_notes}}
{{/has_tests}}

{{#isStandardOrFull}}
## Como trabajar con agentes de IA

### Formato de tareas
- Comienza con un objetivo claro en una sola frase.
- Indica los archivos exactos que se pueden cambiar.
- Incluye restricciones (sin deps nuevas, sin expansion de alcance, salida deterministica).
- Define criterios de aceptacion explicitos antes de implementar.

### Solicitud de diffs y verificacion
- Pide un resumen de cambios por archivo con motivos.
- Pide los comandos exactos ejecutados para validar.
- Pide un resumen de salida de pruebas (pasadas/fallidas y conteos).
- Exige mencionar riesgos conocidos o tareas de seguimiento.

### Protocolo de ejecucion
1. Revisa primero los archivos relevantes y resume hallazgos.
2. Propone el cambio seguro mas pequeno.
3. Implementa de forma incremental y ejecuta pruebas tras cada paso relevante.
4. Reporta que cambio, que se valido y que falta.

## Definicion de terminado ampliada
- [ ] El alcance queda implementado por completo sin cambios no relacionados.
- [ ] La salida sigue siendo deterministica para las mismas entradas.
- [ ] No se filtran marcadores al markdown generado.
- [ ] Las rutas de error fallan con mensajes claros.
- [ ] Se actualizan documentacion y pruebas cuando cambia el comportamiento.

## Lista de depuracion
- Reproduce con un comando deterministico.
- Captura comportamiento esperado vs real.
- Confirma supuestos de entorno (version de Node, package manager, cwd).
- Revisa primero resolucion de modulos y normalizacion de rutas.
- Valida longitud y formato del contenido generado.
- Reejecuta pruebas minimas enfocadas antes de la suite completa.

## Estrategia de pruebas
- Prioriza pruebas rapidas y deterministicas sobre integraciones amplias e inestables.
- Manten fixtures pequenos y representativos.
- Aserta fragmentos estables de salida, no redaccion volatil.
{{#has_tests}}
- Verifica el comando canonico de pruebas: `{{commands.test}}`.
- Agrega pruebas de regresion para cada fix en render o deteccion.
{{/has_tests}}
{{^has_tests}}
- Si no existe script de pruebas, documenta pasos de verificacion manual.
{{/has_tests}}

{{#is_unknown_generic}}
## Guia de ejecucion para proyectos genericos

### Alcance y limites
- Prefiere cambios minimos y reversibles sobre refactors amplios.
- Manten explicitos los supuestos de runtime y package manager.
- Reutiliza convenciones de carpetas existentes antes de crear estructura nueva.
- Documenta cualquier tradeoff intencional en las notas finales de handoff.
- Manten estable el comportamiento publico salvo que la tarea exija cambiarlo.

### Mapa base del repositorio
- Confirma carpetas de codigo fuente actuales (`src`, `lib`, `app`, `scripts`) antes de editar.
- Confirma ubicaciones de pruebas (`tests`, `__tests__`, `spec`) antes de agregar archivos.
- Confirma punto de entradas de configuracion (`tsconfig`, linter, formatter, flujo de CI) antes de actualizar.
- Manten salida generada deterministica en runners Windows y Linux.
- Confirma ruta de salida y reglas de ownership antes de escribir AGENTS.md.

### Flujo de cambios
1. Reproduce el problema con un comando deterministico.
2. Aisla la capa minima a actualizar (detect, render, validate o cli).
3. Agrega o actualiza pruebas enfocadas antes de regresion amplia.
4. Reporta archivos cambiados, comandos ejecutados y riesgos residuales.

### Validacion cuando faltan scripts canonicos
- Ejecuta cada comando canonico disponible y captura la salida.
{{^has_dev}}
- Si no existe script dev, describe el arranque manual en notas del PR.
{{/has_dev}}
{{^has_build}}
- Si no existe script de build, valida directamente la sintaxis de TypeScript o del bundler.
{{/has_build}}
{{^has_tests}}
- Si no existe script de pruebas, agrega pasos de verificacion manual con entradas deterministicas.
{{/has_tests}}
{{^has_lint}}
- Si no existe script de lint, documenta chequeos de estilo aplicados en revision.
{{/has_lint}}
{{^has_format}}
- Si no existe script de formato, manten cambios de formato aislados y minimos.
{{/has_format}}

### Lista generica de PR
- [ ] Alcance y archivos cambiados coinciden con la solicitud original.
- [ ] Se adjunta evidencia de validacion para cada cambio de comportamiento declarado.
- [ ] Los supuestos de compatibilidad hacia atras son explicitos.
- [ ] Se preserva salida deterministica para las mismas entradas.
- [ ] Se listan tareas de seguimiento cuando el trabajo se difiere intencionalmente.

### Notas de handoff a incluir (repos genericos)
- Que cambio: lista de archivos y motivo.
- Como validar: comandos exactos y salidas esperadas.
- Riesgos: que podria romperse y como detectarlo rapido.
- Rollback: ruta de reversa mas segura si hace falta.

### Actualizacion segura de scripts y docs
- Si un script de `package.json` cambia, actualiza "Comandos canonicos".
- Para cambios de build/test/lint, incluye salida antes/despues de los comandos.
- Manten cambios de CI minimos y cross-platform.
- Prefiere cambios de configuracion reversibles y acotados a la tarea.

### Verificaciones previas al merge
- Previsualiza encabezados y legibilidad de lista de verificacion.
- Reejecuta ejemplos de comandos en un clon limpio.
- Confirma que la salida por perfil se mantiene dentro de limites.
- Confirma que no se filtren marcadores.
{{/is_unknown_generic}}

## Haz / No hagas
### Haz
- Preserva el comportamiento existente salvo que se solicite un cambio.
- Manten commits pequenos y revisables.
- Falla rapido ante entrada de usuario invalida.
- Prefiere condiciones explicitas sobre heuristicas ocultas.

### No hagas
- No inventes comandos que no existen en los scripts del package.
- No ignores silenciosamente errores de validacion.
- No mezcles refactors no relacionados con trabajo funcional.
- No agregues dependencias salvo necesidad estricta.

## Plantilla de handoff del agente
### Campos obligatorios
- Objetivo: una frase que describa el estado final esperado.
- Alcance: archivos o carpetas exactas que pueden cambiar.
- Restricciones: lo que no debe cambiar.
- Validacion: comandos que prueban el cambio.
- Riesgos: incertidumbre conocida o items de seguimiento.

### Formato de actualizacion de estado
- Completado: items concretos finalizados.
- En progreso: paso activo actual.
- Siguiente: accion inmediata.
- Bloqueos: informacion faltante o dependencia externa.

### Lista de revision
- [ ] El diff por archivo es facil de seguir.
- [ ] Las pruebas cubren el comportamiento cambiado.
- [ ] La salida se mantiene deterministica.
- [ ] No hay cambios de comportamiento ocultos.
- [ ] El manejo de errores es explicito.
- [ ] La documentacion refleja el nuevo comportamiento.

### Reglas de escalamiento
- Escala cuando los requisitos entran en conflicto.
- Escala antes de agregar dependencias.
- Escala antes de tocar modulos no relacionados.
- Escala ante implicaciones de seguridad ambiguas.
{{/isStandardOrFull}}

{{#isFull}}
## Protocolo avanzado para agentes

### Matriz de riesgo de cambios
- Riesgo bajo: ajustes de texto, redaccion en docs, pruebas aisladas.
- Riesgo medio: cambios en condiciones de template y umbrales de validacion.
- Riesgo alto: logica de deteccion de comandos, escrituras en filesystem y parseo de argumentos CLI.
- Para riesgo medio/alto, exige ejemplos explicitos de antes/despues.

### Lista de handoff para PR
- Incluye justificacion para cada archivo cambiado.
- Incluye comandos de verificacion y resultados.
- Lista garantias de compatibilidad hacia atras.
- Lista riesgos residuales y mitigaciones.

### Flujo de triage de fallas
1. Confirma el comando que falla y el texto exacto del error.
2. Aisla si la falla es de deteccion, renderizado o validacion.
3. Reproduce con fixture antes de tocar rutas de produccion.
4. Agrega cobertura de regresion antes de cerrar el fix.

### Notas de endurecimiento de CI
- Manten manejo de rutas neutral entre plataformas (`path.join`, sin supuestos de shell).
- Manten pruebas independientes del estado local de la maquina.
- Evita aserciones sensibles al tiempo.
- Manten artefactos generados reproducibles entre OS.

### Matriz de verificacion
| Capa | Verificacion | Evidencia |
|---|---|---|
| CLI | Parseo de argumentos | salida del comando |
| Deteccion | scripts/framework | resultado del fixture |
| Renderizado | secciones por perfil | vista previa markdown |
| Validacion | limites/marcadores | pruebas unitarias |
| E2E | comando dry-run | pruebas ok |

### Guia de rollback
1. Revierte primero bloques de template especificos por perfil.
2. Manten soporte de parser solo si es compatible hacia atras.
3. Reejecuta pruebas de perfil compact y e2e.
4. Reintroduce cambios en porciones mas pequenas.

### Protocolo de comunicacion
- Resume supuestos antes de codificar.
- Reporta archivos cambiados inmediatamente despues de cada edicion.
- Reporta comandos ejecutados y resultados.
- Reporta riesgos no resueltos antes del handoff.

### Auditoria post-merge
- Verifica que los ejemplos del README sigan funcionando como estan documentados.
- Verifica que SPEC y comportamiento sigan alineados.
- Verifica CI verde en al menos un runner de Windows.
- Verifica que la salida compact por defecto permanezca igual.
- Verifica que standard/full se mantengan dentro de limites configurados.

### Plantilla minima de reporte de falla
- Comando: comando exacto que falla
- Esperado: que deberia pasar
- Real: que paso
- Capa sospechosa: detect/render/validate/cli
- Fixture de reproduccion: ruta usada

### Puerta final de liberacion
- Confirma que los limites por perfil pasen el validador.
- Confirma que las validaciones de marcadores sigan estrictas.
- Confirma que la salida compact por defecto no cambie.
- Confirma que las docs coincidan con los flags implementados.
- Confirma suite de pruebas en verde en modo CI.
- Confirma que no haya archivos no relacionados modificados.
- Confirma que el markdown generado siga iniciando con # AGENTS.
- Confirma orden de perfiles full > standard > compact.

{{#is_unknown_generic}}
## Guia operativa para perfil full generico

### Politica de CI y ramas
- Exige build, lint y pruebas (o chequeos manuales documentados) antes del merge.
- Manten nombres de rama asociados a una tarea o issue.
- Agrega notas de rollback cuando cambie comportamiento o templates.

### Verificacion extra para repos genericos
- Verifica rutas de comandos npm/yarn/pnpm cuando se toquen scripts.
- Captura salida antes/despues para secciones de perfil afectadas.
- Incluye una prueba de ruta de falla para cambios en validador o CLI.
{{/is_unknown_generic}}
{{/isFull}}

## Seguridad
{{security_notes}}

---
*Generado por agents-md v{{generator_version}}*
