# AGENTS.md

## Propósito del repositorio
{{project_description}}

## Tech stack
{{#stacks}}
- {{.}}
{{/stacks}}

## Comandos canónicos
- Instalar dependencias: `{{commands.install}}`
{{#has_dev}}
- Ejecutar en local: `{{commands.dev}}`
{{/has_dev}}
{{#has_build}}
- Build: `{{commands.build}}`
{{/has_build}}
{{#has_lint}}
- Lint: `{{commands.lint}}`
{{/has_lint}}
{{#has_format}}
- Format: `{{commands.format}}`
{{/has_format}}
{{#has_tests}}
- Tests: `{{commands.test}}`
{{/has_tests}}

## Definition of Done
Antes de considerar una tarea completa:
{{#has_tests}}
- [ ] `{{commands.test}}` pasa sin errores
{{/has_tests}}
{{#has_lint}}
- [ ] `{{commands.lint}}` pasa sin errores
{{/has_lint}}
- [ ] No añadir dependencias nuevas sin confirmación
- [ ] Componentes no tienen warnings de React
- [ ] Documentar props de componentes exportados

## Estilo y convenciones
{{style_notes}}

### Estructura de componentes
- Un componente por archivo
- Archivo nombrado igual que el componente exportado (PascalCase)
- Exports nombrados para componentes, default para páginas

### Gestión de estado
- State local con `useState` para UI state
- Props drilling evitado con Context API o state management library
- Side effects con `useEffect`, memoización con `useMemo`/`useCallback` cuando sea necesario

{{#has_tests}}
## Testing guidelines
{{testing_notes}}

### Cobertura esperada
- Componentes: interacciones de usuario, renderizado condicional
- Hooks personalizados: lógica de negocio
- Utils: funciones puras con casos edge
{{/has_tests}}

{{#isStandardOrFull}}
## How to work with AI agents

### Task format
- Start with a short scope statement and expected result.
- Name target files before implementation.
- Include constraints (no extra deps, keep ESM, deterministic output).
- Ask for acceptance criteria in testable terms.

### Requesting diffs and validation
- Request file-level summary and reason per file.
- Ask for exact commands used for validation.
- Ask for test totals (files/tests passed).
- Ask for explicit mention of tradeoffs.

### React delivery checklist
- Keep component contracts stable unless scope requires change.
- Confirm hooks order is preserved.
- Validate props and event naming consistency.
- Keep rendering behavior deterministic.

## Expanded Definition of Done
- [ ] Feature scope complete with minimal diff.
- [ ] No React warnings introduced in dev/test output.
- [ ] Shared components remain backward compatible.
- [ ] Generated AGENTS content has no placeholders.
- [ ] Docs and tests reflect behavior changes.

## Debug checklist
- Reproduce issue with the smallest fixture.
- Verify canonical commands first (`dev`, `build`, `test`, `lint`).
- Check path handling and platform neutrality.
- Validate generated markdown for required sections.
- Re-run focused tests before full test suite.

## Testing strategy
- Prioritize unit tests for render and validation logic.
- Keep e2e tests focused on one deterministic CLI flow.
- Assert key lines, not entire snapshots.
{{#has_tests}}
- Keep command examples aligned with `{{commands.test}}`.
{{/has_tests}}

## Do / Don't
### Do
- Do keep components readable and narrowly scoped.
- Do prefer explicit conditions in templates.
- Do report behavior changes with concrete examples.
- Do preserve default profile behavior.

### Don't
- Don't couple tests to OS-specific path formats.
- Don't introduce hidden side effects in renderers.
- Don't use placeholders as runtime fallbacks in final output.
- Don't grow scope beyond requested profile behavior.

## Agent handoff template
### Required fields
- Goal: one sentence describing expected final state.
- Scope: exact files or folders that can change.
- Constraints: what must not change.
- Validation: commands that prove the change.
- Risks: known uncertainty or follow-up items.

### Status update format
- Completed: concrete items done.
- In progress: current active step.
- Next: immediate next action.
- Blockers: missing info or external dependency.

### Review checklist
- [ ] File-level diff is easy to follow.
- [ ] Tests cover changed behavior.
- [ ] Output remains deterministic.
- [ ] No hidden behavior changes.
- [ ] Error handling is explicit.
- [ ] Documentation reflects new behavior.

### Escalation rules
- Escalate when requirements conflict.
- Escalate before adding dependencies.
- Escalate before touching unrelated modules.
- Escalate on ambiguous security implications.
{{/isStandardOrFull}}

{{#isFull}}
## Advanced agent protocol

### Review depth by risk
- Low: wording/layout-only changes in templates.
- Medium: profile-gated content and validator thresholds.
- High: CLI option parsing and output file writes.
- Require targeted regression tests for medium/high changes.

### PR handoff checklist
- Include before/after output examples for each profile.
- Include exact commands run locally.
- Include compatibility statement for default `compact`.
- Include residual risk notes.

### Incident response quick flow
1. Reproduce with fixture and explicit profile flag.
2. Verify detection output before template rendering.
3. Confirm validator behavior matches selected profile limits.
4. Patch with minimal diff and add coverage.

### CI hardening notes
- Avoid shell-dependent command execution in tests.
- Use `process.execPath` and argument arrays.
- Use `path.join`/`path.resolve` consistently.
- Keep tests deterministic and fast.

### Verification matrix
| Layer | Check | Evidence |
|---|---|---|
| CLI | Arg parsing | command output |
| Detection | scripts/framework | fixture result |
| Rendering | profile sections | markdown preview |
| Validation | limits/placeholders | unit tests |
| E2E | dry-run command | test pass |

### Rollback playbook
1. Revert profile-specific template blocks first.
2. Keep parser support only if backward compatible.
3. Re-run compact profile tests and e2e.
4. Re-introduce changes in smaller slices.

### Communication protocol
- Summarize assumptions before coding.
- Report changed files immediately after edit step.
- Report executed commands and outcomes.
- Report unresolved risks before handoff.

### Post-merge audit
- Verify README examples still run as documented.
- Verify SPEC and behavior remain aligned.
- Verify CI pass on at least one Windows runner.
- Verify default compact output remains unchanged.
- Verify standard/full remain within configured limits.

### Minimal failure report template
- Command: exact failing command
- Expected: what should happen
- Actual: what happened
- Suspected layer: detect/render/validate/cli
- Reproduction fixture: path used

### Final release gate
- Confirm profile-specific limits pass validator.
- Confirm placeholder checks remain strict.
- Confirm default compact output is unchanged.
- Confirm docs match implemented flags.
- Confirm test suite is green in CI mode.
- Confirm no unrelated files changed.
- Confirm generated markdown still starts with # AGENTS.
- Confirm profile ordering full > standard > compact.
{{/isFull}}

## Seguridad
{{security_notes}}

### React-specific
- Sanitizar inputs antes de usar `dangerouslySetInnerHTML`
- Validar props con PropTypes o TypeScript
- No exponer API keys en código cliente

---
*Generated by agents-md v{{generator_version}}*
